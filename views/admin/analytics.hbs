{{!-- Admin Analytics with TAP ME IN! Branding --}}
<div class="container-fluid">
    <div class="row">
        <!-- Admin Sidebar -->
        <nav class="col-md-3 col-lg-2 d-md-block" style="background: var(--brand-navy-darker); min-height: calc(100vh - 152px); position: sticky; top: 76px;">
            <div class="position-sticky pt-3">
                <div class="d-flex align-items-center mb-4 px-3">
                    <i class="bi bi-shield-check fs-2 me-2" style="color: var(--brand-yellow);"></i>
                    <div>
                        <h5 class="text-white mb-0">ADMIN</h5>
                        <small style="color: var(--brand-yellow);">TAP ME IN!</small>
                    </div>
                </div>
                
                <div class="mb-4 px-3">
                    <small class="text-uppercase" style="color: var(--brand-yellow); font-weight: 700; letter-spacing: 1px;">Main</small>
                </div>
                
                <a href="/admin" class="d-block p-3 mb-2 text-decoration-none rounded mx-2" style="color: white; transition: var(--transition);" onmouseover="this.style.background='rgba(255, 201, 20, 0.15)'; this.style.transform='translateX(4px)'" onmouseout="this.style.background=''; this.style.transform=''">
                    <i class="bi bi-speedometer2 me-2"></i>Overview
                </a>
                
                <a href="/admin/users" class="d-block p-3 mb-2 text-decoration-none rounded mx-2" style="color: white; transition: var(--transition);" onmouseover="this.style.background='rgba(255, 201, 20, 0.15)'; this.style.transform='translateX(4px)'" onmouseout="this.style.background=''; this.style.transform=''">
                    <i class="bi bi-people me-2"></i>Users
                </a>
                
                <a href="/admin/cards" class="d-block p-3 mb-2 text-decoration-none rounded mx-2" style="color: white; transition: var(--transition);" onmouseover="this.style.background='rgba(255, 201, 20, 0.15)'; this.style.transform='translateX(4px)'" onmouseout="this.style.background=''; this.style.transform=''">
                    <i class="bi bi-credit-card me-2"></i>Cards
                </a>
                
                <a href="/admin/analytics" class="d-block p-3 mb-2 text-decoration-none rounded mx-2" style="background: var(--brand-yellow); color: var(--brand-navy); font-weight: 600;">
                    <i class="bi bi-graph-up me-2"></i>Analytics
                </a>
                
                <div class="mb-4 mt-4 px-3">
                    <small class="text-uppercase" style="color: var(--brand-yellow); font-weight: 700; letter-spacing: 1px;">System</small>
                </div>
                
                <a href="/admin/support" class="d-block p-3 mb-2 text-decoration-none rounded mx-2" style="color: white; transition: var(--transition);" onmouseover="this.style.background='rgba(255, 201, 20, 0.15)'; this.style.transform='translateX(4px)'" onmouseout="this.style.background=''; this.style.transform=''">
                    <i class="bi bi-life-preserver me-2"></i>Support
                </a>
                
                <a href="/admin/settings" class="d-block p-3 mb-2 text-decoration-none rounded mx-2" style="color: white; transition: var(--transition);" onmouseover="this.style.background='rgba(255, 201, 20, 0.15)'; this.style.transform='translateX(4px)'" onmouseout="this.style.background=''; this.style.transform=''">
                    <i class="bi bi-gear me-2"></i>Settings
                </a>
                
                <div class="mb-4 mt-4 px-3">
                    <small class="text-uppercase" style="color: var(--brand-yellow); font-weight: 700; letter-spacing: 1px;">Quick</small>
                </div>
                
                <a href="/dashboard" class="d-block p-3 mb-2 text-decoration-none rounded mx-2" style="color: white; transition: var(--transition);" onmouseover="this.style.background='rgba(255, 201, 20, 0.15)'; this.style.transform='translateX(4px)'" onmouseout="this.style.background=''; this.style.transform=''">
                    <i class="bi bi-person-circle me-2"></i>User View
                </a>
                
                <a href="/auth/logout" class="d-block p-3 mb-2 text-decoration-none rounded mx-2" style="color: var(--brand-red); transition: var(--transition);" onmouseover="this.style.background='rgba(255, 89, 100, 0.15)'; this.style.transform='translateX(4px)'" onmouseout="this.style.background=''; this.style.transform=''">
                    <i class="bi bi-box-arrow-right me-2"></i>Logout
                </a>
            </div>
        </nav>
        
        <!-- Main content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="fade-in">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-4">
                    <h1 class="display-4 fw-bold" style="color: var(--brand-navy);">
                        <i class="bi bi-graph-up me-2" style="color: var(--brand-yellow);"></i>
                        System Analytics
                    </h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <div class="btn-group me-2">
                            <button type="button" class="btn btn-outline-secondary" onclick="exportReport()">
                                <i class="bi bi-download me-1"></i>Export Report
                            </button>
                        </div>
                        <div class="btn-group">
                            <select class="form-select" id="timeRange" onchange="changeTimeRange(this.value)">
                                <option value="7">Last 7 days</option>
                                <option value="30" selected>Last 30 days</option>
                                <option value="90">Last 90 days</option>
                                <option value="365">Last year</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Key Metrics -->
                <div class="row g-4 mb-4">
                    <div class="col-xl-3 col-md-6">
                        <div class="card" style="transition: var(--transition);" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='var(--shadow-lg)'" onmouseout="this.style.transform=''; this.style.boxShadow='var(--shadow-sm)'">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <div>
                                        <div class="small text-uppercase fw-bold mb-1" style="color: var(--text-secondary); letter-spacing: 0.5px;">Total Users</div>
                                        <div class="h3 fw-bold mb-2" style="color: var(--brand-navy);">{{stats.totalUsers}}</div>
                                        <div class="small fw-semibold" style="color: #28a745; background: rgba(40, 167, 69, 0.2); padding: 0.25rem 0.5rem; border-radius: 8px; display: inline-block;">
                                            <i class="bi bi-arrow-up"></i> +12% this month
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-center justify-content-center" style="width: 48px; height: 48px; border-radius: 12px; background: var(--brand-navy); color: white;">
                                        <i class="bi bi-people fs-4"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-xl-3 col-md-6">
                        <div class="card" style="transition: var(--transition);" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='var(--shadow-lg)'" onmouseout="this.style.transform=''; this.style.boxShadow='var(--shadow-sm)'">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <div>
                                        <div class="small text-uppercase fw-bold mb-1" style="color: var(--text-secondary); letter-spacing: 0.5px;">Total Cards</div>
                                        <div class="h3 fw-bold mb-2" style="color: var(--brand-navy);">{{stats.totalCards}}</div>
                                        <div class="small fw-semibold" style="color: var(--brand-navy); background: rgba(52, 89, 149, 0.2); padding: 0.25rem 0.5rem; border-radius: 8px; display: inline-block;">
                                            <i class="bi bi-credit-card"></i> {{stats.activeCards}} active
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-center justify-content-center" style="width: 48px; height: 48px; border-radius: 12px; background: #28a745; color: white;">
                                        <i class="bi bi-credit-card fs-4"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-xl-3 col-md-6">
                        <div class="card" style="transition: var(--transition);" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='var(--shadow-lg)'" onmouseout="this.style.transform=''; this.style.boxShadow='var(--shadow-sm)'">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <div>
                                        <div class="small text-uppercase fw-bold mb-1" style="color: var(--text-secondary); letter-spacing: 0.5px;">Total Taps</div>
                                        <div class="h3 fw-bold mb-2" style="color: var(--brand-navy);">{{tapAnalytics.totalTaps}}</div>
                                        <div class="small fw-semibold" style="color: var(--brand-navy); background: rgba(255, 201, 20, 0.2); padding: 0.25rem 0.5rem; border-radius: 8px; display: inline-block;">
                                            <i class="bi bi-hand-index"></i> {{round tapAnalytics.avgTapsPerCard}} avg/card
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-center justify-content-center" style="width: 48px; height: 48px; border-radius: 12px; background: var(--brand-yellow); color: var(--brand-navy);">
                                        <i class="bi bi-hand-index fs-4"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-xl-3 col-md-6">
                        <div class="card" style="transition: var(--transition);" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='var(--shadow-lg)'" onmouseout="this.style.transform=''; this.style.boxShadow='var(--shadow-sm)'">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <div>
                                        <div class="small text-uppercase fw-bold mb-1" style="color: var(--text-secondary); letter-spacing: 0.5px;">Revenue</div>
                                        <div class="h3 fw-bold mb-2" style="color: var(--brand-navy);">${{stats.monthlyRevenue}}</div>
                                        <div class="small fw-semibold" style="color: #28a745; background: rgba(40, 167, 69, 0.2); padding: 0.25rem 0.5rem; border-radius: 8px; display: inline-block;">
                                            <i class="bi bi-arrow-up"></i> +8% this month
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-center justify-content-center" style="width: 48px; height: 48px; border-radius: 12px; background: #28a745; color: white;">
                                        <i class="bi bi-currency-dollar fs-4"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div class="row g-4 mb-4">
                    <!-- User Growth Chart -->
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-header" style="background: var(--brand-navy); color: white;">
                                <h5 class="mb-0">
                                    <i class="bi bi-graph-up me-2"></i>User Growth (30 days)
                                </h5>
                            </div>
                            <div class="card-body">
                                <div id="userGrowthChart" style="height: 300px; width: 100%;">
                                    <!-- Chart placeholder -->
                                    <div class="d-flex align-items-center justify-content-center h-100" style="background: var(--bg-secondary); border-radius: 8px;">
                                        <div class="text-center">
                                            <i class="bi bi-graph-up fs-1 mb-3" style="color: var(--brand-navy);"></i>
                                            <p class="text-muted">User growth chart would be rendered here</p>
                                            <small class="text-muted">Using Chart.js or similar charting library</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Card Activation Chart -->
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-header" style="background: var(--brand-navy); color: white;">
                                <h5 class="mb-0">
                                    <i class="bi bi-credit-card me-2"></i>Card Activations (30 days)
                                </h5>
                            </div>
                            <div class="card-body">
                                <div id="cardActivationChart" style="height: 300px; width: 100%;">
                                    <!-- Chart placeholder -->
                                    <div class="d-flex align-items-center justify-content-center h-100" style="background: var(--bg-secondary); border-radius: 8px;">
                                        <div class="text-center">
                                            <i class="bi bi-credit-card fs-1 mb-3" style="color: var(--brand-navy);"></i>
                                            <p class="text-muted">Card activation chart would be rendered here</p>
                                            <small class="text-muted">Using Chart.js or similar charting library</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Detailed Analytics -->
                <div class="row g-4 mb-4">
                    <!-- Top Performing Cards -->
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-header" style="background: var(--brand-navy); color: white;">
                                <h5 class="mb-0">
                                    <i class="bi bi-trophy me-2"></i>Top Performing Cards
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th>Card ID</th>
                                                <th>Owner</th>
                                                <th>Taps</th>
                                                <th>Last 7 days</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <div class="fw-semibold">CARD001</div>
                                                    <small class="text-muted">Business Card</small>
                                                </td>
                                                <td>John Doe</td>
                                                <td><span class="badge bg-success">247</span></td>
                                                <td><span class="text-success">+15</span></td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <div class="fw-semibold">CARD042</div>
                                                    <small class="text-muted">Personal</small>
                                                </td>
                                                <td>Jane Smith</td>
                                                <td><span class="badge bg-success">189</span></td>
                                                <td><span class="text-success">+12</span></td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <div class="fw-semibold">CARD093</div>
                                                    <small class="text-muted">Event Card</small>
                                                </td>
                                                <td>Mike Johnson</td>
                                                <td><span class="badge bg-warning">156</span></td>
                                                <td><span class="text-success">+8</span></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Geographic Distribution -->
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-header" style="background: var(--brand-navy); color: white;">
                                <h5 class="mb-0">
                                    <i class="bi bi-geo-alt me-2"></i>Geographic Distribution
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span>United States</span>
                                        <span class="fw-semibold">45%</span>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar" style="width: 45%; background: var(--brand-navy);"></div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span>Canada</span>
                                        <span class="fw-semibold">23%</span>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar" style="width: 23%; background: var(--brand-yellow);"></div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span>United Kingdom</span>
                                        <span class="fw-semibold">18%</span>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar" style="width: 18%; background: #28a745;"></div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span>Australia</span>
                                        <span class="fw-semibold">14%</span>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar" style="width: 14%; background: #17a2b8;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- System Health -->
                <div class="row g-4 mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header" style="background: var(--brand-navy); color: white;">
                                <h5 class="mb-0">
                                    <i class="bi bi-heart-pulse me-2"></i>System Health & Performance
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="row g-4">
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <div class="display-6 fw-bold mb-2" style="color: #28a745;">99.9%</div>
                                            <div class="small text-uppercase fw-bold" style="color: var(--text-secondary);">Uptime</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <div class="display-6 fw-bold mb-2" style="color: var(--brand-navy);">< 100ms</div>
                                            <div class="small text-uppercase fw-bold" style="color: var(--text-secondary);">Avg Response</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <div class="display-6 fw-bold mb-2" style="color: var(--brand-yellow);">0</div>
                                            <div class="small text-uppercase fw-bold" style="color: var(--text-secondary);">Errors (24h)</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <div class="display-6 fw-bold mb-2" style="color: #17a2b8;">15GB</div>
                                            <div class="small text-uppercase fw-bold" style="color: var(--text-secondary);">Data Transfer</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<script>
function exportReport() {
    const timeRange = document.getElementById('timeRange').value;
    window.location.href = `/admin/analytics/export?days=${timeRange}`;
}

function changeTimeRange(days) {
    // In a real implementation, this would reload the page with the new time range
    // and regenerate all charts and statistics
    console.log('Changing time range to:', days + ' days');
    // For now, just show an alert
    alert(`Analytics would be updated to show data for the last ${days} days`);
}

// Placeholder for chart initialization
document.addEventListener('DOMContentLoaded', function() {
    // In a real implementation, you would initialize Chart.js charts here
    console.log('Charts would be initialized here using the data:', {
        userGrowth: {{json userGrowth}},
        cardGrowth: {{json cardGrowth}},
        tapAnalytics: {{json tapAnalytics}}
    });
});
</script>